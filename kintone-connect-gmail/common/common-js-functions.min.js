(function(){"use strict";window.kintoneCustomize={setting:{element:{style:{spinner:'.kintoneCustomizeloading{position: fixed; width: 100%; height:100%;top: 0; left:0; z-index:1000; background:rgba(204, 204, 204, 0.3)}.kintoneCustomizeloading:before{position: fixed; top: calc(50% - 25px);content: "";left: calc(50% - 25px);border:8px solid #f3f3f3;border-radius:50%;border-top:8px solid #3498db;width:50px;height:50px;-webkit-animation:spin .8s linear infinite; animation:spin .8s linear infinite}@-webkit-keyframes spin{0%{-webkit-transform:rotate(0)}100%{-webkit-transform:rotate(360deg)}}@keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}'}},apiUrl:{app:"/k/v1/app",form:"/k/v1/app/form/fields",layout:"/k/v1/app/form/layout",record:"/k/v1/record",records:"/k/v1/records",user:"/v1/users",userGroup:"/v1/user/groups",userOrganization:"/v1/user/organizations",file:"/k/v1/file.json?fileKey=",status:"/k/v1/record/status",statusApp:"/k/v1/app/status"},fieldSupport:{makePrefix:["__ID__","SINGLE_LINE_TEXT","DROP_DOWN"]},message:{requestNotAvailable:"Error occurred when retrieving data, please try again!"}},data:{user:{code:kintone.getLoginUser().code,group:null}},preload:function(){this.ui.addStyleToHead(this.setting.element.style.spinner)},fnc:{app:{}},kintoneListenEvent:function(e,t,n){kintone.events.on(e,function(e){return n&&n[t]?n[t](e):t(e)})},disableFields:function(e,t){try{var n=this.setting.app[e].fieldCode.disabled.length>0;return n&&this.setting.app[e].fieldCode.disabled.forEach(function(n){t[this.setting.app[e].fieldCode[n]].disabled=!0},this),t}catch(e){this.showError(e)}},record:function(e){var t=this;return{recordData:e,getStringByPrefix:function(e){var n=e;for(var r in this.recordData)this.recordData.hasOwnProperty(r)&&(n=t.setting.fieldSupport.makePrefix.indexOf(this.recordData[r].type)===-1?n.replace("{{"+r+"}}","_"+r.toUpperCase()+"_"):n.replace("{{"+r+"}}",this.recordData[r].value));return n=t.getStringByPrefixDate(n,new Date)},getValueByType:function(e){var t=e.toUpperCase();for(var n in this.recordData)if(this.recordData.hasOwnProperty(n)&&this.recordData[n].type===t)return this.recordData[n].value;return null},checkFieldExists:function(e){var t={status:!0,invalidField:""};return"string"==typeof e?(t.status=this.recordData.hasOwnProperty(e),t.invalidField=e):e.constructor===Array?e.forEach(function(e){this.recordData.hasOwnProperty(e)||(t.status=!1,t.invalidField+=","+e)},this):t.status=!1,t}}},records:function(e){return{recordsData:e,getIds:function(e){var t=[];return this.recordsData.forEach(function(e){t.push(parseInt(e.$id.value,10))},this),t}}},getUserGroup:function(e){var t=this;return this.apiRequest(t.setting.apiUrl.userGroup,"GET",{code:e}).then(function(e){var t=[];return e.groups.forEach(function(e){t.push(e.code)}),t})},apiRequestWithProxy:function(e,t,n,r){var i=this,o={"X-Cybozu-API-Token":r};"GET"!==t&&"DELETE"!==t&&(o["Content-Type"]="application/json");var a=this.setting.apiUrl[e]||"/v1/apis",s="GET"!==t&&"DELETE"!==t?kintone.api.url(a):kintone.api.urlForGet(a,n);return new kintone.Promise(function(e,r){kintone.proxy(s,t,o,n,function(t){var n=window.JSON.parse(t);"string"==typeof n.code?r(n):e(n)},function(e){r(e)})}).then({},function(e){return i.showError(e),!1})},apiRequest:function(e,t,n){var r=this,i=this.setting.apiUrl[e]||"/k/v1/apis";return new kintone.Promise(function(e,r){kintone.api(kintone.api.url(i,!0),t,n,function(t){e(t)},function(e){r(e)})}).then({},function(e){return r.showError(e),!1})},getFile:function(e,t){var n=this;return new kintone.Promise(function(n,r){var i=new XMLHttpRequest;i.open("GET",e,!0),i.setRequestHeader("X-Requested-With","XMLHttpRequest"),i.responseType="arraybuffer",i.onload=function(){var e=new window.Uint8Array(this.response),r=new Blob([e],{type:t+";charset=utf-8;"});n(r)},i.onerror=function(e){r(e)},i.send()}).then({},function(e){return n.showError(e),!1})},formRequest:function(e,t,n,r){return new kintone.Promise(function(i,o){var a=new XMLHttpRequest;a.open(t,e),"undefined"!=typeof r&&r.length>0&&r.forEach(function(e){e.key&&e.value&&a.setRequestHeader(e.key,e.value)}),a.setRequestHeader("X-Requested-With","XMLHttpRequest"),a.onload=function(){200===a.status?i(this):o(a)},a.send(n)})},getTimeUser:function(){var e=this;return this.getTimeServer().then(function(t){if(!window.moment)return e.getDateString(new Date(t));var n=window.moment.tz(t,kintone.getLoginUser().timezone);return n.format("YYYY-MM-DD")})},getTimeServer:function(){return kintone.proxy(kintone.api.urlForGet("/v1/app",{}),"GET",{},{}).then(function(e){return e[2].Date})},getStringByPrefixDate:function(e,t){var n=e,r=t.getFullYear().toString(),i=(t.getMonth()+1).toString(),o=t.getDate().toString(),a=t.getHours().toString(),s=t.getMinutes().toString();return n=n.replace(/{{yyyy}}|{{YYYY}}/g,r),n=n.replace(/{{yy}}|{{YY}}/g,r.substring(2)),n=n.replace(/{{mm}}|{{MM}}/g,i[1]?i:"0"+i[0]),n=n.replace(/{{dd}}|{{DD}}/g,o[1]?o:"0"+o[0]),n=n.replace(/{{hh}}|{{HH}}/g,a[1]?a:"0"+a[0]),n=n.replace(/{{ii}}|{{II}}/g,s[1]?s:"0"+s[0])},getDateStringByFormat:function(e,t){"undefined"==typeof t&&(t=new Date);var n=e,r=t.getFullYear().toString(),i=(t.getMonth()+1).toString(),o=t.getDate().toString(),a=t.getHours().toString(),s=t.getMinutes().toString();return n=n.replace(/yyyy|YYYY/g,r),n=n.replace(/yy|YY/g,r.substring(2)),n=n.replace(/mm|MM/g,i[1]?i:"0"+i[0]),n=n.replace(/dd|DD/g,o[1]?o:"0"+o[0]),n=n.replace(/hh|HH/g,a[1]?a:"0"+a[0]),n=n.replace(/ii|II/g,s[1]?s:"0"+s[0])},getDateString:function(e){if("undefined"==typeof e)return"";if(isNaN(e.getUTCFullYear())||isNaN(e.getUTCMonth())||isNaN(e.getUTCDate()))return"";var t=e.getUTCFullYear()+"-";return t+=e.getUTCMonth()>8?e.getUTCMonth()+1:"0"+(e.getUTCMonth()+1),t+="-"+e.getUTCDate()},filePath:function(e){return{filePath:e,getExtention:function(){return this.filePath.toString().split(".").reverse()[0]},getBasename:function(e){var t="undefined"==typeof e?"/":e;return this.filePath.toString().split(t).reverse()[0]},getFileName:function(){return this.getBasename().replace("."+this.getExtention(),"")}}},ui:{element:function(e){var t=e;return{append:function(e){try{return e.constructor===Array?(e.forEach(function(e){t.appendChild(e)}),this):(t.appendChild(e),this)}catch(e){return this}},appendTo:function(e){try{return e.appendChild(t),t=e,this}catch(e){return this}},prepend:function(e){try{return e.constructor===Array?(e.forEach(function(e){t.insertBefore(e,t.firstChild)}),this):(t.insertBefore(e,t.firstChild),this)}catch(e){return this}}}},elements:function(e){var t=[];if("string"==typeof e){var n=document.querySelectorAll(e);t=Array.prototype.slice.call(n)}else t.push(e);return{elArr:t,on:function(e,t){return this.each(function(n){n.addEventListener(e,t)}),this},each:function(e){this.elArr.forEach(function(t,n){e(t,n)},this)},data:function(e,t){var n="data-";if("undefined"==typeof t)return this.elArr[0].getAttribute(n+e);try{this.elArr.forEach(function(r){this.attr(n+e,t)},this)}catch(e){return!1}return this},attr:function(e,t){return 0===this.elArr.length?"undefined"!=typeof t?this:null:"undefined"!=typeof t?(this.elArr.forEach(function(n){n.setAttribute(e,t)},this),this):this.elArr[0].getAttribute(e)},removeAttr:function(e){this.attr()},val:function(e){return 0===this.elArr.length?"undefined"!=typeof e?this:null:"undefined"!=typeof e?(this.elArr.forEach(function(t){t.value=e},this),this):this.elArr[0].value},html:function(e){return 0===this.elArr.length?"undefined"!=typeof e?this:null:"undefined"!=typeof e?(this.elArr.forEach(function(t){t.innerHTML=e},this),this):this.elArr[0].innerHTML},focus:function(){0!==this.elArr.length&&this.elArr[0].focus()},remove:function(){0!==this.elArr.length&&this.elArr.forEach(function(e){try{e.parentNode.removeChild(e)}catch(e){}},this)},trigger:function(e){0!==this.elArr.length&&this.elArr.forEach(function(t){function n(){if("function"==typeof Event)return new Event(e,{bubbles:!0,cancelable:!0});var t=document.createEvent("Event");return t.initEvent(e,!0,!0),t}t.dispatchEvent(n())},this)},addClass:function(e){try{return this.elArr.forEach(function(t){var n=t.className.split(" ");n.indexOf(e)===-1&&(n.push(e),t.className=n.join(" ").trim())},this),this}catch(e){return this}},removeClass:function(e){try{return this.hasClass(e)?(this.elArr.forEach(function(t){var n=t.className.split(" ");n.splice(n.indexOf(e),1),t.className=n.join(" ")},this),this):this}catch(e){return this}},hasClass:function(e){if("undefined"==typeof e)return!1;try{var t=this.elArr[0].className.split(" ");return t.indexOf(e)!==-1}catch(e){return!1}},append:function(e){try{return this.elArr.forEach(function(t){return e.constructor===Array?(e.forEach(function(e){t.appendChild(e.elArr?e.elArr[0]||null:e)}),this):void t.appendChild(e.elArr?e.elArr[0]||null:e)},this),this}catch(e){return this}},appendTo:function(e){try{return this.elArr.forEach(function(t){if(e.constructor===Array)return e.forEach(function(e){var n=e.elArr?e.elArr[0]||null:e;n.appendChild(t)}),this;var n=e.elArr?e.elArr[0]||null:e;n.appendChild(t)},this),this}catch(e){return window.console.error(e),this}},prepend:function(e){try{return this.elArr.forEach(function(t){return e.constructor===Array?(e.forEach(function(e){t.insertBefore(e.elArr?e.elArr[0]||null:e,t.firstChild)}),this):void t.insertBefore(e.elArr?e.elArr[0]||null:e,t.firstChild)}),this}catch(e){return this}}}},createButton:function(e,t){if(document.getElementById(e.id))return null;var n=document.createElement("button");n.id=e.id||"",n.className=e.class||"";var r=t?t[e.text]||e.text||"":e.text||"";return n.innerHTML=r,n.style.cssText=e.style||"",n},addStyleToHead:function(e){var t=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css",n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e)),t.appendChild(n)},loading:{loading:null,show:function(e){var t="kintoneCustomizeloading",n=document.getElementById(t),r=document.createElement("div");if(!this.loading||!n){if(e===!1)return void(n&&n.parentNode.removeChild(n));r.className=t,r.id=t,document.body.appendChild(r),this.loading=!0}},hide:function(){this.loading=!1,this.show(!1)}},createMessageTemplate:function(){var e=document.createElement("div"),t=document.createElement("div"),n=document.createElement("header"),r=document.createElement("ul"),i=document.createElement("span"),o=document.createElement("span");return o.className="close",o.addEventListener("click",function(){e.className="hidden"}),e.id="kintoneCustomizeMessage",e.className="hidden",this.element(n).append([i,o]),this.element(t).append([n,r]).appendTo(e),document.body.appendChild(e),e}},objectValueToArray:function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(e[n]);return t},objectMerge:function(e,t){return Object.keys(t).forEach(function(n){e[n]=t[n]}),e},showError:function(e){try{var t=e.code?e:window.JSON.parse(e);window.console.error(t.code+"\n"+t.message),this.alertMessage(t.message+"\n"+t.code,"error")}catch(t){window.console.error(e)}this.ui.loading.hide()},alertMessage:function(e,t){var n="#kintoneCustomizeMessage",r=document.querySelector(n);switch(r&&this.ui.elements(r).remove(),r=this.ui.createMessageTemplate(),t){case"success":r.className="kintoneCustomizeMessageSuccess";break;default:r.className=""}var i=document.querySelector(n+" header>span"),o=document.querySelector(n+" ul");if(i.innerHTML="",o.innerHTML="",e.header)return i.innerHTML=e.header,void(e.messages&&(e.messages.length>0&&(document.querySelector(n+">div").style.width="auto"),e.messages.forEach(function(e){var t=document.createElement("li");t.innerHTML=e,o.appendChild(t)})));var a=document.createElement("li");a.innerHTML=e,o.appendChild(a),setTimeout(function(){r.className="hidden"},1e4)}},window.kintoneCustomize.preload()})();